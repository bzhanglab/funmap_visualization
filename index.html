<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>FunMap Radial Tree Chart</title>
    <script src="/js/echarts.min.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <style type="text/css">
        html,
        body {
            height: 100%;
            margin: 0;
        }

        #chart {
            min-height: 100%;
        }

        td {
            padding: 0 1em;
            text-align: center;
            vertical-align: middle;
        }
    </style>
</head>

<body>
    <div id="chart" style="width: 100%; height: 100%;"></div>
    <script>
        fetch("data/go.json").then((res) => res.json()).then((go_data) => {
            fetch("data/funmap.json").then((res) => res.json()).then((chartData) => {
                var chartOptions = {
                    tooltip: {
                        trigger: 'item',
                        triggerOn: 'mousemove',
                        formatter: function (params, ticket, callback) {
                            node_go = go_data[params.name]
                            var content = `<h1 style="text-align:center;">${params.name}</h1><table><thead><tr><th>GO Category</th><th>GO ID</th><th>Name</th><th>p-Value</th></tr></thead><tbody><tr><td>Biological Process</td><td>${node_go['gobp']['id']}</td><td>${node_go['gobp']['name']}</td><td>${node_go['gobp']['p']}</td></tr><tr><td>Cellular Component</td><td>${node_go['gocc']['id']}</td><td>${node_go['gocc']['name']}</td><td>${node_go['gocc']['p']}</td></tr><tr><td>Molecular Function</td><td>${node_go['gomf']['id']}</td><td>${node_go['gomf']['name']}</td><td>${node_go['gomf']['p']}</td></tr></tbody></table>`;
                            let el = document.createElement('div');
                            el.innerHTML = content;
                            return el;
                        },
                    },
                    series: [
                        {
                            type: 'tree',
                            roam: true,
                            name: 'FunMap',
                            data: [chartData],
                            top: '10%',
                            bottom: '10%',
                            left: '10%',
                            right: '10%',
                            layout: 'radial',
                            symbol: 'emptyCircle',
                            symbolSize: 5,
                            initialTreeDepth: 1,
                            label: {
                                position: 'top',
                                verticalAlign: 'middle',
                                align: 'right',
                                fontSize: 12,
                            },
                            leaves: {
                                label: {
                                    position: 'bottom',
                                    verticalAlign: 'middle',
                                    align: 'left'
                                }
                            },
                            expandAndCollapse: true,
                            animationDuration: 550,
                            animationDurationUpdate: 750,
                            emphasis: {
                                focus: 'descendant'
                            }
                        }
                    ]
                };

                // Initialize the chart
                var chart = echarts.init(document.getElementById('chart'));
                chart.setOption(chartOptions);
            })
        });
    </script>
</body>

</html>